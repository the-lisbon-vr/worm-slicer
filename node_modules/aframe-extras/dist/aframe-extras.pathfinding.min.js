!function n(t,e,r){function i(u,c){if(!e[u]){if(!t[u]){var a="function"==typeof require&&require;if(!c&&a)return a(u,!0);if(o)return o(u,!0);var s=new Error("Cannot find module '"+u+"'");throw s.code="MODULE_NOT_FOUND",s}var l=e[u]={exports:{}};t[u][0].call(l.exports,function(n){var e=t[u][1][n];return i(e||n)},l,l.exports,n,t,e,r)}return e[u].exports}for(var o="function"==typeof require&&require,u=0;u<r.length;u++)i(r[u]);return i}({1:[function(n,t,e){n("./src/pathfinding").registerAll()},{"./src/pathfinding":4}],2:[function(n,t,e){!function(t){function e(n,t){var e=new Number(n+"").toFixed(parseInt(t));return parseFloat(e)}function r(){var n,t,e,r,i,o,u=[],c={};for(o=arguments.length-1,e=arguments[0].length,t=0,n=0;n<=o;n++)(r=arguments[n].length)<e&&(t=n,e=r);for(n=0;n<=o;n++){r=n===t?0:n||t,i=arguments[r].length;for(var a=0;a<i;a++){var s=arguments[r][a];c[s]===n-1?n===o?(u.push(s),c[s]=0):c[s]=n:0===n&&(c[s]=0)}}return u}function i(n){this.content=[],this.scoreFunction=n}function o(n,t){for(var e=!1,r=-1,i=n.length,o=i-1;++r<i;o=r)(n[r].z<=t.z&&t.z<n[o].z||n[o].z<=t.z&&t.z<n[r].z)&&t.x<(n[o].x-n[r].x)*(t.z-n[r].z)/(n[o].z-n[r].z)+n[r].x&&(e=!e);return e}function u(n,t,e){var r=(t.centroid,1e5),i=-1e5,u=[];return f.each(t.vertexIds,function(n){r=Math.min(e[n].y,r),i=Math.max(e[n].y,i),u.push(e[n])}),!!(n.y<i+.5&&n.y>r-.5&&o(u,n))}function c(n,t,e){var r=t.x-n.x,i=t.z-n.z;return(e.x-n.x)*i-r*(e.z-n.z)}function a(n,t){return j(n,t)<1e-5}function s(){this.portals=[]}var l,f=n("underscore"),h=window.THREE,p=function(){return{tick:function(){}}},v=function(n){var t,e,r;for(t=0,e=n.faces.length;t<e;t++)r=n.faces[t],r.centroid=new h.Vector3(0,0,0),r.centroid.add(n.vertices[r.a]),r.centroid.add(n.vertices[r.b]),r.centroid.add(n.vertices[r.c]),r.centroid.divideScalar(3)},d=1,g={width:30},y=function(n){var t=n.polygons;n.vertices;l=new p("Building polygon groups[:bar] :percent",f.extend(g,{total:t.length}));var e=[],r=0,i=function(n){f.each(n.neighbours,function(t){f.isUndefined(t.group)&&(t.group=n.group,i(t))})};return f.each(t,function(n,t){l.tick(),f.isUndefined(n.group)&&(n.group=r++,i(n)),e[n.group]||(e[n.group]=[]),e[n.group].push(n)}),console.log("Groups built: ",e.length),e},m=function(n,t){n.neighbours=[];for(var e=0,i=t.polygons.length;e<i;e++)if(n!==t.polygons[e]&&!(n.centroid.distanceToSquared(t.polygons[e].centroid)>1e4)){var o=r(n.vertexIds,t.polygons[e].vertexIds);o.length>=2&&n.neighbours.push(t.polygons[e])}},b=function(n){console.log("Vertices:",n.vertices.length,"polygons:",n.faces.length);var t=[],e=n.vertices,r=n.faceVertexUvs;l=new p("Building polygons      [:bar] :percent",f.extend(g,{total:n.faces.length})),f.each(n.faces,function(n){l.tick(),t.push({id:d++,vertexIds:[n.a,n.b,n.c],centroid:n.centroid,normal:n.normal,neighbours:[]})});var i={polygons:t,vertices:e,faceVertexUvs:r};return l=new p("Calculating neighbours [:bar] :percent",f.extend(g,{total:t.length})),f.each(t,function(n){l.tick(),m(n,i)}),i},x=function(n){return v(n),n.mergeVertices(),b(n)},w=function(n,t){var e=n.vertexIds,r=t.vertexIds,i=[];return f.each(e,function(n){f.contains(r,n)&&i.push(n)}),i.length<2?[]:(f.contains(i,e[0])&&f.contains(i,e[e.length-1])&&e.push(e.shift()),f.contains(i,r[0])&&f.contains(i,r[r.length-1])&&r.push(r.shift()),i=[],f.each(e,function(n){f.contains(r,n)&&i.push(n)}),i)},_=function(n){var t={};f.each(n.vertices,function(n){n.x=e(n.x,2),n.y=e(n.y,2),n.z=e(n.z,2)}),t.vertices=n.vertices;var r=y(n);t.groups=[];var i=function(n,t){for(var e=0;e<n.length;e++)if(t===n[e])return e};return l=new p("Grouping               [:bar] :percent",f.extend(g,{total:r.length})),f.each(r,function(n){l.tick();var r=[];f.each(n,function(t){var o=[];f.each(t.neighbours,function(t){o.push(i(n,t))});var u=[];f.each(t.neighbours,function(n){u.push(w(t,n))}),t.centroid.x=e(t.centroid.x,2),t.centroid.y=e(t.centroid.y,2),t.centroid.z=e(t.centroid.z,2),r.push({id:i(n,t),neighbours:o,vertexIds:t.vertexIds,centroid:t.centroid,portals:u})}),t.groups.push(r)}),t};i.prototype={push:function(n){this.content.push(n),this.sinkDown(this.content.length-1)},pop:function(){var n=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),n},remove:function(n){var t=this.content.indexOf(n),e=this.content.pop();t!==this.content.length-1&&(this.content[t]=e,this.scoreFunction(e)<this.scoreFunction(n)?this.sinkDown(t):this.bubbleUp(t))},size:function(){return this.content.length},rescoreElement:function(n){this.sinkDown(this.content.indexOf(n))},sinkDown:function(n){for(var t=this.content[n];n>0;){var e=(n+1>>1)-1,r=this.content[e];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[e]=t,this.content[n]=r,n=e}},bubbleUp:function(n){for(var t=this.content.length,e=this.content[n],r=this.scoreFunction(e);;){var i=n+1<<1,o=i-1,u=null;if(o<t){var c=this.content[o],a=this.scoreFunction(c);a<r&&(u=o)}if(i<t){var s=this.content[i];this.scoreFunction(s)<(null===u?r:a)&&(u=i)}if(null===u)break;this.content[n]=this.content[u],this.content[u]=e,n=u}}};var j=function(n,t){var e=n.x-t.x,r=n.y-t.y,i=n.z-t.z;return e*e+r*r+i*i},k={init:function(n){for(var t=0;t<n.length;t++){var e=n[t];e.f=0,e.g=0,e.h=0,e.cost=1,e.visited=!1,e.closed=!1,e.parent=null}},cleanUp:function(n){for(var t=0;t<n.length;t++){var e=n[t];delete e.f,delete e.g,delete e.h,delete e.cost,delete e.visited,delete e.closed,delete e.parent}},heap:function(){return new i(function(n){return n.f})},search:function(n,t,e){k.init(n);var r=k.heap();for(r.push(t);r.size()>0;){var i=r.pop();if(i===e){for(var o=i,u=[];o.parent;)u.push(o),o=o.parent;return this.cleanUp(u),u.reverse()}i.closed=!0;for(var c=k.neighbours(n,i),a=0,s=c.length;a<s;a++){var l=c[a];if(!l.closed){var f=i.g+l.cost,h=l.visited;(!h||f<l.g)&&(l.visited=!0,l.parent=i,!l.centroid||e.centroid,l.h=l.h||k.heuristic(l.centroid,e.centroid),l.g=f,l.f=l.g+l.h,h?r.rescoreElement(l):r.push(l))}}}return[]},heuristic:function(n,t){return j(n,t)},neighbours:function(n,t){for(var e=[],r=0;r<t.neighbours.length;r++)e.push(n[t.neighbours[r]]);return e}},j=function(n,t){var e=n.x-t.x,r=n.y-t.y,i=n.z-t.z;return e*e+r*r+i*i};s.prototype.push=function(n,t){void 0===t&&(t=n),this.portals.push({left:n,right:t})},s.prototype.stringPull=function(){var n,t,e,r=this.portals,i=[],o=0,u=0,s=0;n=r[0].left,t=r[0].left,e=r[0].right,i.push(n);for(var l=1;l<r.length;l++){var f=r[l].left,h=r[l].right;if(c(n,e,h)<=0){if(!(a(n,e)||c(n,t,h)>0)){i.push(t),n=t,o=u,t=n,e=n,u=o,s=o,l=o;continue}e=h,s=l}if(c(n,t,f)>=0){if(!(a(n,t)||c(n,e,f)<0)){i.push(e),n=e,o=s,t=n,e=n,u=o,s=o,l=o;continue}t=f,u=l}}return 0!==i.length&&a(i[i.length-1],r[r.length-1].left)||i.push(r[r.length-1].left),this.path=i,i};var E={};f.extend(t,{buildNodes:function(n){var t=x(n);return _(t)},setZoneData:function(n,t){E[n]=t},getGroup:function(n,t){if(!E[n])return null;var e=null,r=Math.pow(50,2);return f.each(E[n].groups,function(n,i){f.each(n,function(n){var o=j(n.centroid,t);o<r&&(e=i,r=o)})}),e},getRandomNode:function(n,t,e,r){if(!E[n])return new h.Vector3;e=e||null,r=r||0;var i=[],o=E[n].groups[t];return f.each(o,function(n){e&&r?j(e,n.centroid)<r*r&&i.push(n.centroid):i.push(n.centroid)}),f.sample(i)||new h.Vector3},findPath:function(n,t,e,r){var i=E[e].groups[r],o=E[e].vertices,c=null,a=Math.pow(50,2);f.each(i,function(t){var e=j(t.centroid,n);e<a&&(c=t,a=e)},this);var l=null;if(a=Math.pow(50,2),f.each(i,function(n){var e=j(n.centroid,t);e<a&&u(t,n,o)&&(l=n,a=e)},this),!c||!l)return null;var p=k.search(i,c,l),v=new s;v.push(n);for(var d=0;d<p.length;d++){var g=p[d],y=p[d+1];if(y){var m=function(n,t){for(var e=0;e<n.neighbours.length;e++)if(n.neighbours[e]===t.id)return n.portals[e]}(g,y);v.push(o[m[0]],o[m[1]])}}v.push(t),v.stringPull();var b=[];return f.each(v.path,function(n){var t=new h.Vector3(n.x,n.y,n.z);b.push(t)}),b.shift(),b}})}(void 0===e?this.patrol={}:e)},{underscore:3}],3:[function(n,t,e){(function(){function n(n){function t(t,e,r,i,o,u){for(;o>=0&&o<u;o+=n){var c=i?i[o]:o;r=e(r,t[c],c,t)}return r}return function(e,r,i,o){r=w(r,o,4);var u=!O(e)&&x.keys(e),c=(u||e).length,a=n>0?0:c-1;return arguments.length<3&&(i=e[u?u[a]:a],a+=n),t(e,r,i,u,a,c)}}function r(n){return function(t,e,r){e=_(e,r);for(var i=M(t),o=n>0?0:i-1;o>=0&&o<i;o+=n)if(e(t[o],o,t))return o;return-1}}function i(n,t,e){return function(r,i,o){var u=0,c=M(r);if("number"==typeof o)n>0?u=o>=0?o:Math.max(o+c,u):c=o>=0?Math.min(o+1,c):o+c+1;else if(e&&o&&c)return o=e(r,i),r[o]===i?o:-1;if(i!==i)return o=t(h.call(r,u,c),x.isNaN),o>=0?o+u:-1;for(o=n>0?u:c-1;o>=0&&o<c;o+=n)if(r[o]===i)return o;return-1}}function o(n,t){var e=S.length,r=n.constructor,i=x.isFunction(r)&&r.prototype||s,o="constructor";for(x.has(n,o)&&!x.contains(t,o)&&t.push(o);e--;)(o=S[e])in n&&n[o]!==i[o]&&!x.contains(t,o)&&t.push(o)}var u=this,c=u._,a=Array.prototype,s=Object.prototype,l=Function.prototype,f=a.push,h=a.slice,p=s.toString,v=s.hasOwnProperty,d=Array.isArray,g=Object.keys,y=l.bind,m=Object.create,b=function(){},x=function(n){return n instanceof x?n:this instanceof x?void(this._wrapped=n):new x(n)};void 0!==e?(void 0!==t&&t.exports&&(e=t.exports=x),e._=x):u._=x,x.VERSION="1.8.3";var w=function(n,t,e){if(void 0===t)return n;switch(null==e?3:e){case 1:return function(e){return n.call(t,e)};case 2:return function(e,r){return n.call(t,e,r)};case 3:return function(e,r,i){return n.call(t,e,r,i)};case 4:return function(e,r,i,o){return n.call(t,e,r,i,o)}}return function(){return n.apply(t,arguments)}},_=function(n,t,e){return null==n?x.identity:x.isFunction(n)?w(n,t,e):x.isObject(n)?x.matcher(n):x.property(n)};x.iteratee=function(n,t){return _(n,t,1/0)};var j=function(n,t){return function(e){var r=arguments.length;if(r<2||null==e)return e;for(var i=1;i<r;i++)for(var o=arguments[i],u=n(o),c=u.length,a=0;a<c;a++){var s=u[a];t&&void 0!==e[s]||(e[s]=o[s])}return e}},k=function(n){if(!x.isObject(n))return{};if(m)return m(n);b.prototype=n;var t=new b;return b.prototype=null,t},E=function(n){return function(t){return null==t?void 0:t[n]}},A=Math.pow(2,53)-1,M=E("length"),O=function(n){var t=M(n);return"number"==typeof t&&t>=0&&t<=A};x.each=x.forEach=function(n,t,e){t=w(t,e);var r,i;if(O(n))for(r=0,i=n.length;r<i;r++)t(n[r],r,n);else{var o=x.keys(n);for(r=0,i=o.length;r<i;r++)t(n[o[r]],o[r],n)}return n},x.map=x.collect=function(n,t,e){t=_(t,e);for(var r=!O(n)&&x.keys(n),i=(r||n).length,o=Array(i),u=0;u<i;u++){var c=r?r[u]:u;o[u]=t(n[c],c,n)}return o},x.reduce=x.foldl=x.inject=n(1),x.reduceRight=x.foldr=n(-1),x.find=x.detect=function(n,t,e){var r;if(void 0!==(r=O(n)?x.findIndex(n,t,e):x.findKey(n,t,e))&&-1!==r)return n[r]},x.filter=x.select=function(n,t,e){var r=[];return t=_(t,e),x.each(n,function(n,e,i){t(n,e,i)&&r.push(n)}),r},x.reject=function(n,t,e){return x.filter(n,x.negate(_(t)),e)},x.every=x.all=function(n,t,e){t=_(t,e);for(var r=!O(n)&&x.keys(n),i=(r||n).length,o=0;o<i;o++){var u=r?r[o]:o;if(!t(n[u],u,n))return!1}return!0},x.some=x.any=function(n,t,e){t=_(t,e);for(var r=!O(n)&&x.keys(n),i=(r||n).length,o=0;o<i;o++){var u=r?r[o]:o;if(t(n[u],u,n))return!0}return!1},x.contains=x.includes=x.include=function(n,t,e,r){return O(n)||(n=x.values(n)),("number"!=typeof e||r)&&(e=0),x.indexOf(n,t,e)>=0},x.invoke=function(n,t){var e=h.call(arguments,2),r=x.isFunction(t);return x.map(n,function(n){var i=r?t:n[t];return null==i?i:i.apply(n,e)})},x.pluck=function(n,t){return x.map(n,x.property(t))},x.where=function(n,t){return x.filter(n,x.matcher(t))},x.findWhere=function(n,t){return x.find(n,x.matcher(t))},x.max=function(n,t,e){var r,i,o=-1/0,u=-1/0;if(null==t&&null!=n){n=O(n)?n:x.values(n);for(var c=0,a=n.length;c<a;c++)(r=n[c])>o&&(o=r)}else t=_(t,e),x.each(n,function(n,e,r){((i=t(n,e,r))>u||i===-1/0&&o===-1/0)&&(o=n,u=i)});return o},x.min=function(n,t,e){var r,i,o=1/0,u=1/0;if(null==t&&null!=n){n=O(n)?n:x.values(n);for(var c=0,a=n.length;c<a;c++)(r=n[c])<o&&(o=r)}else t=_(t,e),x.each(n,function(n,e,r){((i=t(n,e,r))<u||i===1/0&&o===1/0)&&(o=n,u=i)});return o},x.shuffle=function(n){for(var t,e=O(n)?n:x.values(n),r=e.length,i=Array(r),o=0;o<r;o++)t=x.random(0,o),t!==o&&(i[o]=i[t]),i[t]=e[o];return i},x.sample=function(n,t,e){return null==t||e?(O(n)||(n=x.values(n)),n[x.random(n.length-1)]):x.shuffle(n).slice(0,Math.max(0,t))},x.sortBy=function(n,t,e){return t=_(t,e),x.pluck(x.map(n,function(n,e,r){return{value:n,index:e,criteria:t(n,e,r)}}).sort(function(n,t){var e=n.criteria,r=t.criteria;if(e!==r){if(e>r||void 0===e)return 1;if(e<r||void 0===r)return-1}return n.index-t.index}),"value")};var z=function(n){return function(t,e,r){var i={};return e=_(e,r),x.each(t,function(r,o){var u=e(r,o,t);n(i,r,u)}),i}};x.groupBy=z(function(n,t,e){x.has(n,e)?n[e].push(t):n[e]=[t]}),x.indexBy=z(function(n,t,e){n[e]=t}),x.countBy=z(function(n,t,e){x.has(n,e)?n[e]++:n[e]=1}),x.toArray=function(n){return n?x.isArray(n)?h.call(n):O(n)?x.map(n,x.identity):x.values(n):[]},x.size=function(n){return null==n?0:O(n)?n.length:x.keys(n).length},x.partition=function(n,t,e){t=_(t,e);var r=[],i=[];return x.each(n,function(n,e,o){(t(n,e,o)?r:i).push(n)}),[r,i]},x.first=x.head=x.take=function(n,t,e){if(null!=n)return null==t||e?n[0]:x.initial(n,n.length-t)},x.initial=function(n,t,e){return h.call(n,0,Math.max(0,n.length-(null==t||e?1:t)))},x.last=function(n,t,e){if(null!=n)return null==t||e?n[n.length-1]:x.rest(n,Math.max(0,n.length-t))},x.rest=x.tail=x.drop=function(n,t,e){return h.call(n,null==t||e?1:t)},x.compact=function(n){return x.filter(n,x.identity)};var F=function(n,t,e,r){for(var i=[],o=0,u=r||0,c=M(n);u<c;u++){var a=n[u];if(O(a)&&(x.isArray(a)||x.isArguments(a))){t||(a=F(a,t,e));var s=0,l=a.length;for(i.length+=l;s<l;)i[o++]=a[s++]}else e||(i[o++]=a)}return i};x.flatten=function(n,t){return F(n,t,!1)},x.without=function(n){return x.difference(n,h.call(arguments,1))},x.uniq=x.unique=function(n,t,e,r){x.isBoolean(t)||(r=e,e=t,t=!1),null!=e&&(e=_(e,r));for(var i=[],o=[],u=0,c=M(n);u<c;u++){var a=n[u],s=e?e(a,u,n):a;t?(u&&o===s||i.push(a),o=s):e?x.contains(o,s)||(o.push(s),i.push(a)):x.contains(i,a)||i.push(a)}return i},x.union=function(){return x.uniq(F(arguments,!0,!0))},x.intersection=function(n){for(var t=[],e=arguments.length,r=0,i=M(n);r<i;r++){var o=n[r];if(!x.contains(t,o)){for(var u=1;u<e&&x.contains(arguments[u],o);u++);u===e&&t.push(o)}}return t},x.difference=function(n){var t=F(arguments,!0,!0,1);return x.filter(n,function(n){return!x.contains(t,n)})},x.zip=function(){return x.unzip(arguments)},x.unzip=function(n){for(var t=n&&x.max(n,M).length||0,e=Array(t),r=0;r<t;r++)e[r]=x.pluck(n,r);return e},x.object=function(n,t){for(var e={},r=0,i=M(n);r<i;r++)t?e[n[r]]=t[r]:e[n[r][0]]=n[r][1];return e},x.findIndex=r(1),x.findLastIndex=r(-1),x.sortedIndex=function(n,t,e,r){e=_(e,r,1);for(var i=e(t),o=0,u=M(n);o<u;){var c=Math.floor((o+u)/2);e(n[c])<i?o=c+1:u=c}return o},x.indexOf=i(1,x.findIndex,x.sortedIndex),x.lastIndexOf=i(-1,x.findLastIndex),x.range=function(n,t,e){null==t&&(t=n||0,n=0),e=e||1;for(var r=Math.max(Math.ceil((t-n)/e),0),i=Array(r),o=0;o<r;o++,n+=e)i[o]=n;return i};var N=function(n,t,e,r,i){if(!(r instanceof t))return n.apply(e,i);var o=k(n.prototype),u=n.apply(o,i);return x.isObject(u)?u:o};x.bind=function(n,t){if(y&&n.bind===y)return y.apply(n,h.call(arguments,1));if(!x.isFunction(n))throw new TypeError("Bind must be called on a function");var e=h.call(arguments,2),r=function(){return N(n,r,t,this,e.concat(h.call(arguments)))};return r},x.partial=function(n){var t=h.call(arguments,1),e=function(){for(var r=0,i=t.length,o=Array(i),u=0;u<i;u++)o[u]=t[u]===x?arguments[r++]:t[u];for(;r<arguments.length;)o.push(arguments[r++]);return N(n,e,this,this,o)};return e},x.bindAll=function(n){var t,e,r=arguments.length;if(r<=1)throw new Error("bindAll must be passed function names");for(t=1;t<r;t++)e=arguments[t],n[e]=x.bind(n[e],n);return n},x.memoize=function(n,t){var e=function(r){var i=e.cache,o=""+(t?t.apply(this,arguments):r);return x.has(i,o)||(i[o]=n.apply(this,arguments)),i[o]};return e.cache={},e},x.delay=function(n,t){var e=h.call(arguments,2);return setTimeout(function(){return n.apply(null,e)},t)},x.defer=x.partial(x.delay,x,1),x.throttle=function(n,t,e){var r,i,o,u=null,c=0;e||(e={});var a=function(){c=!1===e.leading?0:x.now(),u=null,o=n.apply(r,i),u||(r=i=null)};return function(){var s=x.now();c||!1!==e.leading||(c=s);var l=t-(s-c);return r=this,i=arguments,l<=0||l>t?(u&&(clearTimeout(u),u=null),c=s,o=n.apply(r,i),u||(r=i=null)):u||!1===e.trailing||(u=setTimeout(a,l)),o}},x.debounce=function(n,t,e){var r,i,o,u,c,a=function(){var s=x.now()-u;s<t&&s>=0?r=setTimeout(a,t-s):(r=null,e||(c=n.apply(o,i),r||(o=i=null)))};return function(){o=this,i=arguments,u=x.now();var s=e&&!r;return r||(r=setTimeout(a,t)),s&&(c=n.apply(o,i),o=i=null),c}},x.wrap=function(n,t){return x.partial(t,n)},x.negate=function(n){return function(){return!n.apply(this,arguments)}},x.compose=function(){var n=arguments,t=n.length-1;return function(){for(var e=t,r=n[t].apply(this,arguments);e--;)r=n[e].call(this,r);return r}},x.after=function(n,t){return function(){if(--n<1)return t.apply(this,arguments)}},x.before=function(n,t){var e;return function(){return--n>0&&(e=t.apply(this,arguments)),n<=1&&(t=null),e}},x.once=x.partial(x.before,2);var I=!{toString:null}.propertyIsEnumerable("toString"),S=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];x.keys=function(n){if(!x.isObject(n))return[];if(g)return g(n);var t=[];for(var e in n)x.has(n,e)&&t.push(e);return I&&o(n,t),t},x.allKeys=function(n){if(!x.isObject(n))return[];var t=[];for(var e in n)t.push(e);return I&&o(n,t),t},x.values=function(n){for(var t=x.keys(n),e=t.length,r=Array(e),i=0;i<e;i++)r[i]=n[t[i]];return r},x.mapObject=function(n,t,e){t=_(t,e);for(var r,i=x.keys(n),o=i.length,u={},c=0;c<o;c++)r=i[c],u[r]=t(n[r],r,n);return u},x.pairs=function(n){for(var t=x.keys(n),e=t.length,r=Array(e),i=0;i<e;i++)r[i]=[t[i],n[t[i]]];return r},x.invert=function(n){for(var t={},e=x.keys(n),r=0,i=e.length;r<i;r++)t[n[e[r]]]=e[r];return t},x.functions=x.methods=function(n){var t=[];for(var e in n)x.isFunction(n[e])&&t.push(e);return t.sort()},x.extend=j(x.allKeys),x.extendOwn=x.assign=j(x.keys),x.findKey=function(n,t,e){t=_(t,e);for(var r,i=x.keys(n),o=0,u=i.length;o<u;o++)if(r=i[o],t(n[r],r,n))return r},x.pick=function(n,t,e){var r,i,o={},u=n;if(null==u)return o;x.isFunction(t)?(i=x.allKeys(u),r=w(t,e)):(i=F(arguments,!1,!1,1),r=function(n,t,e){return t in e},u=Object(u));for(var c=0,a=i.length;c<a;c++){var s=i[c],l=u[s];r(l,s,u)&&(o[s]=l)}return o},x.omit=function(n,t,e){if(x.isFunction(t))t=x.negate(t);else{var r=x.map(F(arguments,!1,!1,1),String);t=function(n,t){return!x.contains(r,t)}}return x.pick(n,t,e)},x.defaults=j(x.allKeys,!0),x.create=function(n,t){var e=k(n);return t&&x.extendOwn(e,t),e},x.clone=function(n){return x.isObject(n)?x.isArray(n)?n.slice():x.extend({},n):n},x.tap=function(n,t){return t(n),n},x.isMatch=function(n,t){var e=x.keys(t),r=e.length;if(null==n)return!r;for(var i=Object(n),o=0;o<r;o++){var u=e[o];if(t[u]!==i[u]||!(u in i))return!1}return!0};var D=function(n,t,e,r){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof x&&(n=n._wrapped),t instanceof x&&(t=t._wrapped);var i=p.call(n);if(i!==p.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+n==""+t;case"[object Number]":return+n!=+n?+t!=+t:0==+n?1/+n==1/t:+n==+t;case"[object Date]":case"[object Boolean]":return+n==+t}var o="[object Array]"===i;if(!o){if("object"!=typeof n||"object"!=typeof t)return!1;var u=n.constructor,c=t.constructor;if(u!==c&&!(x.isFunction(u)&&u instanceof u&&x.isFunction(c)&&c instanceof c)&&"constructor"in n&&"constructor"in t)return!1}e=e||[],r=r||[];for(var a=e.length;a--;)if(e[a]===n)return r[a]===t;if(e.push(n),r.push(t),o){if((a=n.length)!==t.length)return!1;for(;a--;)if(!D(n[a],t[a],e,r))return!1}else{var s,l=x.keys(n);if(a=l.length,x.keys(t).length!==a)return!1;for(;a--;)if(s=l[a],!x.has(t,s)||!D(n[s],t[s],e,r))return!1}return e.pop(),r.pop(),!0};x.isEqual=function(n,t){return D(n,t)},x.isEmpty=function(n){return null==n||(O(n)&&(x.isArray(n)||x.isString(n)||x.isArguments(n))?0===n.length:0===x.keys(n).length)},x.isElement=function(n){return!(!n||1!==n.nodeType)},x.isArray=d||function(n){return"[object Array]"===p.call(n)},x.isObject=function(n){var t=typeof n;return"function"===t||"object"===t&&!!n},x.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(n){x["is"+n]=function(t){return p.call(t)==="[object "+n+"]"}}),x.isArguments(arguments)||(x.isArguments=function(n){return x.has(n,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(x.isFunction=function(n){return"function"==typeof n||!1}),x.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},x.isNaN=function(n){return x.isNumber(n)&&n!==+n},x.isBoolean=function(n){return!0===n||!1===n||"[object Boolean]"===p.call(n)},x.isNull=function(n){return null===n},x.isUndefined=function(n){return void 0===n},x.has=function(n,t){return null!=n&&v.call(n,t)},x.noConflict=function(){return u._=c,this},x.identity=function(n){return n},x.constant=function(n){return function(){return n}},x.noop=function(){},x.property=E,x.propertyOf=function(n){return null==n?function(){}:function(t){return n[t]}},x.matcher=x.matches=function(n){return n=x.extendOwn({},n),function(t){return x.isMatch(t,n)}},x.times=function(n,t,e){var r=Array(Math.max(0,n));t=w(t,e,1);for(var i=0;i<n;i++)r[i]=t(i);return r},x.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))},x.now=Date.now||function(){return(new Date).getTime()};var R={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},T=x.invert(R),V=function(n){var t=function(t){return n[t]},e="(?:"+x.keys(n).join("|")+")",r=RegExp(e),i=RegExp(e,"g");return function(n){return n=null==n?"":""+n,r.test(n)?n.replace(i,t):n}};x.escape=V(R),x.unescape=V(T),x.result=function(n,t,e){var r=null==n?void 0:n[t];return void 0===r&&(r=e),x.isFunction(r)?r.call(n):r};var B=0;x.uniqueId=function(n){var t=++B+"";return n?n+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var U=/(.)^/,q={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},C=/\\|'|\r|\n|\u2028|\u2029/g,P=function(n){return"\\"+q[n]};x.template=function(n,t,e){!t&&e&&(t=e),t=x.defaults({},t,x.templateSettings);var r=RegExp([(t.escape||U).source,(t.interpolate||U).source,(t.evaluate||U).source].join("|")+"|$","g"),i=0,o="__p+='";n.replace(r,function(t,e,r,u,c){return o+=n.slice(i,c).replace(C,P),i=c+t.length,e?o+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":u&&(o+="';\n"+u+"\n__p+='"),t}),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var u=new Function(t.variable||"obj","_",o)}catch(n){throw n.source=o,n}var c=function(n){return u.call(this,n,x)};return c.source="function("+(t.variable||"obj")+"){\n"+o+"}",c},x.chain=function(n){var t=x(n);return t._chain=!0,t};var G=function(n,t){return n._chain?x(t).chain():t};x.mixin=function(n){x.each(x.functions(n),function(t){var e=x[t]=n[t];x.prototype[t]=function(){var n=[this._wrapped];return f.apply(n,arguments),G(this,e.apply(x,n))}})},x.mixin(x),x.each(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=a[n];x.prototype[n]=function(){var e=this._wrapped;return t.apply(e,arguments),"shift"!==n&&"splice"!==n||0!==e.length||delete e[0],G(this,e)}}),x.each(["concat","join","slice"],function(n){var t=a[n];x.prototype[n]=function(){return G(this,t.apply(this._wrapped,arguments))}}),x.prototype.value=function(){return this._wrapped},x.prototype.valueOf=x.prototype.toJSON=x.prototype.value,x.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}).call(this)},{}],4:[function(n,t,e){t.exports={"nav-mesh":n("./nav-mesh"),"nav-controller":n("./nav-controller"),system:n("./system"),registerAll:function(n){this._registered||(n=n||window.AFRAME,n.components["nav-mesh"]||n.registerComponent("nav-mesh",this["nav-mesh"]),n.components["nav-controller"]||n.registerComponent("nav-controller",this["nav-controller"]),n.systems.nav||n.registerSystem("nav",this.system),this._registered=!0)}}},{"./nav-controller":5,"./nav-mesh":6,"./system":7}],5:[function(n,t,e){t.exports={schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2}},init:function(){this.system=this.el.sceneEl.systems.nav,this.system.addController(this),this.path=[],this.raycaster=new THREE.Raycaster},remove:function(){this.system.removeController(this)},update:function(){this.path.length=0},tick:function(){var n=new THREE.Vector3,t=new THREE.Vector3,e=new THREE.Vector3;return function(r,i){var o=this.el,u=this.data,c=this.raycaster,a=u.speed*i/1e3;if(u.active){if(this.path.length||(this.path=this.system.getPath(this.el.object3D,n.copy(u.destination)),this.path=this.path||[],o.emit("nav-start")),!this.path.length)return console.warn("[nav] Unable to find path to %o.",u.destination),this.el.setAttribute("nav-controller",{active:!1}),void o.emit("nav-end");var s=o.object3D.position,l=this.path[0];t.subVectors(l,s);var f,h=t.length();if(h<a){if(this.path.shift(),!this.path.length)return this.el.setAttribute("nav-controller",{active:!1}),void o.emit("nav-end");f=this.path[0]}else e.copy(t.setLength(a)).add(s),f=l;f.y=s.y,o.object3D.lookAt(f),c.ray.origin.copy(e),c.ray.origin.y+=1.5,c.ray.direction.y=-1;var p=c.intersectObject(this.system.getNavMesh());p.length?(t.subVectors(p[0].point,s),s.add(t.setLength(a))):s.copy(e)}}}()}},{}],6:[function(n,t,e){t.exports={init:function(){this.system=this.el.sceneEl.systems.nav,this.loadNavMesh(),this.el.addEventListener("model-loaded",this.loadNavMesh.bind(this))},loadNavMesh:function(){var n=this.el.getObject3D("mesh");if(n){var t;n.traverse(function(n){n.isMesh&&(t=n)}),t&&this.system.setNavMesh(t)}}}},{}],7:[function(n,t,e){var r=n("../../lib/patrol");window._=n("underscore"),t.exports={init:function(){this.navMesh=null,this.nodes=null,this.controllers=new Set},setNavMesh:function(n){var t=n.geometry.isBufferGeometry?(new THREE.Geometry).fromBufferGeometry(n.geometry):n.geometry;this.navMesh=new THREE.Mesh(t),this.nodes=r.buildNodes(this.navMesh.geometry),r.setZoneData("level",this.nodes)},getNavMesh:function(){return this.navMesh},addController:function(n){this.controllers.add(n)},removeController:function(n){this.controllers.remove(n)},getPath:function(n,t){var e=n.el.object3D.position,i=r.getGroup("level",e);return r.findPath(e,t,"level",i)}}},{"../../lib/patrol":2,underscore:3}]},{},[1]);